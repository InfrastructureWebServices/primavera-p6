<html>

<head>
    <title>Primavera P6 Viewer</title>
    {% include 'headers.html' %}
    <script src=" https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js "></script>
    <script src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.min.js"></script>
    <link href="http://cdn.datatables.net/1.11.3/css/jquery.dataTables.min.css" rel="stylesheet" />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js"
        integrity="sha512-XHDcSyqhOoO2ocB7sKOCJEkUjw/pQCJViP1ynpy+EGh/LggzrP6U/V3a++LQTnZT7sCQKeHRyWHfhN2afjXjCg=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.css"
        integrity="sha512-8OVtKyemDe8Koi/74dnSJughhkwnzqq217zUtUumyvx0Z0kF6H0YYFobH2kEYjKMNq2xNQyN64dnleqecTSL0A=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

    <script src="https://cdn.jsdelivr.net/npm/ibm-gantt-chart@0.5.29/dist/ibm-gantt-chart.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/ibm-gantt-chart@0.5.29/dist/ibm-gantt-chart.min.css" rel="stylesheet">

    <!--  Page styles  -->
    <style>
        html {
            height: 100%;
        }

        body {
            height: 100%;
            margin: 0;
            padding: 0;
        }

        #gantt {
            height: 100%;
            width: 100%;
        }

        .dataTables_wrapper {
            min-height: 100%;
        }
    </style>
</head>

<body>
    <div id="gantt">
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            $.ajax({ url: "./{{plan_id}}/get" }).done(function (data) {
                var config = {
                    data: data,
                    type: Gantt.type.ACTIVITY_CHART,
                    constraints: {
                        renderer: [
                            {
                                selector(object, ctx) {
                                    return ctx.gantt.layoutLabelMode === 'right';
                                },
                                nodeLabelLayout: 'right',
                            },
                            {
                                selector(object, ctx) {
                                    return ctx.gantt.layoutLabelMode === 'left';
                                },
                                nodeLabelLayout: 'left',
                            },
                            {
                                selector(object, ctx) {
                                    return ctx.gantt.layoutLabelMode === 'noLinkCrossing';
                                },
                                nodeLabelLayout: {
                                    padding: 12, // Horizontal padding between the label and the node or link
                                    // If possible place the node label in a free space between a node/link and a link.
                                    //      If several holes are possible, choose the one the closest from the node.
                                    // If not possible, place the text after the last link from the node
                                    startLayout(act, labelWidth, ctx) {
                                        this.closestHole = null;
                                        this.furtherLeft = this.padding;
                                        this.furtherRight = this.padding;
                                        this.w = labelWidth + this.padding;
                                    },
                                    nextLink(act, left, linkX, previousX, nodeX, ctx) {
                                        if (Math.abs(linkX - previousX) >= this.w) {
                                            const newHole = left
                                                ? -Math.abs(nodeX - previousX) - this.padding
                                                : Math.abs(previousX - nodeX) + this.padding;
                                            if (this.closestHole === null || Math.abs(newHole) < Math.abs(this.closestHole)) {
                                                this.closestHole = newHole + (left ? -this.padding : this.padding);
                                            }
                                        }
                                        // Keep track of the position of the furthest link from the node on this side
                                        else if (left) {
                                            this.furtherLeft = Math.max(Math.abs(nodeX - linkX) + this.padding, this.furtherLeft);
                                        } else {
                                            this.furtherRight = Math.max(Math.abs(linkX - nodeX) + this.padding, this.furtherRight);
                                        }
                                    },
                                    getNodeToLabelSpacing(act, bbox, textWidth, ctx) {
                                        return this.closestHole !== null
                                            ? this.closestHole
                                            : this.furtherLeft < this.furtherRight
                                                ? -this.furtherLeft
                                                : this.furtherRight;
                                    },
                                },
                            },
                        ],
                    },
                    toolbar: [
                        'title',
                        'search',
                        'separator',
                        'mini',
                        'separator',
                        'fitToContent',
                        'zoomIn',
                        'zoomOut',
                        'separator',
                        // User specific label layout
                        {
                            type: 'select',
                            text: 'Show',
                            options: [
                                { value: 'default', text: 'Default' },
                                { value: 'right', text: 'Right' },
                                { value: 'left', text: 'Left' },
                                { value: 'noLinkCrossing', text: 'No link crossing' },
                            ],
                            onchange(value, ctx) {
                                const { gantt } = ctx;
                                gantt.layoutLabelMode = value;
                                gantt.draw(true);
                            },
                        },
                    ],
                    title: 'GLU Program',
                };
                globalThis.gantt = new Gantt('gantt', config);
                //$('#loader').remove();
            });
        });


    </script>
</body>

</html>